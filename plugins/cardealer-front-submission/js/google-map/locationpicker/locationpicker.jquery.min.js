!function(t){function e(t,e){var n=new google.maps.Map(t,e),o=new google.maps.Marker({position:new google.maps.LatLng(54.19335,-3.92695),map:n,title:"Drag Me",visible:e.markerVisible,draggable:e.markerDraggable,icon:void 0!==e.markerIcon?e.markerIcon:void 0});return{map:n,marker:o,circle:null,location:o.position,radius:e.radius,locationName:e.locationName,addressComponents:{formatted_address:null,addressLine1:null,addressLine2:null,streetName:null,streetNumber:null,city:null,district:null,state:null,stateOrProvince:null},settings:e.settings,domContainer:t,geodecoder:new google.maps.Geocoder}}var n={drawCircle:function(e,n,o,a){return null!=e.circle&&e.circle.setMap(null),o>0?(o*=1,(a=t.extend({strokeColor:"#0000FF",strokeOpacity:.35,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.2},a)).map=e.map,a.radius=o,a.center=n,e.circle=new google.maps.Circle(a),e.circle):null},setPosition:function(t,e,n){t.location=e,t.marker.setPosition(e),t.map.panTo(e),this.drawCircle(t,e,t.radius,{}),t.settings.enableReverseGeocode?this.updateLocationName(t,n):n&&n.call(this,t)},locationFromLatLng:function(t){return{latitude:t.lat(),longitude:t.lng()}},addressByFormat:function(t,e){for(var n=null,o=t.length-1;o>=0;o--)t[o].types.indexOf(e)>=0&&(n=t[o]);return n||t[0]},updateLocationName:function(t,e){t.geodecoder.geocode({latLng:t.marker.position},(function(o,a){if(a==google.maps.GeocoderStatus.OK&&o.length>0){var i=n.addressByFormat(o,t.settings.addressFormat);t.locationName=i.formatted_address,t.addressComponents=n.address_component_from_google_geocode(i.address_components)}else if(a==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)return setTimeout((function(){n.updateLocationName(t,e)}),1e3);e&&e.call(this,t)}))},address_component_from_google_geocode:function(t){for(var e={},n=t.length-1;n>=0;n--){var o=t[n];o.types.indexOf("postal_code")>=0?e.postalCode=o.short_name:o.types.indexOf("street_number")>=0?e.streetNumber=o.short_name:o.types.indexOf("route")>=0?e.streetName=o.short_name:o.types.indexOf("locality")>=0?e.city=o.short_name:o.types.indexOf("sublocality")>=0?e.district=o.short_name:o.types.indexOf("administrative_area_level_1")>=0?e.stateOrProvince=o.short_name:o.types.indexOf("country")>=0&&(e.country=o.short_name)}return e.addressLine1=[e.streetNumber,e.streetName].join(" ").trim(),e.addressLine2="",e}};function o(t){return null!=a(t)}function a(e){return t(e).data("locationpicker")}function i(t,e){if(t){var o=n.locationFromLatLng(e.marker.position);t.latitudeInput&&t.latitudeInput.val(o.latitude).change(),t.longitudeInput&&t.longitudeInput.val(o.longitude).change(),t.radiusInput&&t.radiusInput.val(e.radius).change(),t.locationNameInput&&t.locationNameInput.val(e.locationName).change()}}function r(e,o){if(e){if(e.radiusInput&&e.radiusInput.on("change",(function(e){var a=t(this).val();e.originalEvent&&!isNaN(a)&&(o.radius=a,n.setPosition(o,o.location,(function(t){t.settings.onchanged.apply(o.domContainer,[n.locationFromLatLng(t.location),t.radius,!1])})))})),e.locationNameInput&&o.settings.enableAutocomplete){var a=!1;o.autocomplete=new google.maps.places.Autocomplete(e.locationNameInput.get(0),o.settings.autocompleteOptions),google.maps.event.addListener(o.autocomplete,"place_changed",(function(){a=!1;var t=o.autocomplete.getPlace();t.geometry?n.setPosition(o,t.geometry.location,(function(t){i(e,t),t.settings.onchanged.apply(o.domContainer,[n.locationFromLatLng(t.location),t.radius,!1])})):o.settings.onlocationnotfound(t.name)})),o.settings.enableAutocompleteBlur&&(e.locationNameInput.on("change",(function(t){t.originalEvent&&(a=!0)})),e.locationNameInput.on("blur",(function(r){r.originalEvent&&setTimeout((function(){var r=t(e.locationNameInput).val();r.length>5&&a&&(a=!1,o.geodecoder.geocode({address:r},(function(t,a){a==google.maps.GeocoderStatus.OK&&t&&t.length&&n.setPosition(o,t[0].geometry.location,(function(t){i(e,t),t.settings.onchanged.apply(o.domContainer,[n.locationFromLatLng(t.location),t.radius,!1])}))})))}),1e3)})))}e.latitudeInput&&e.latitudeInput.on("change",(function(e){var a=t(this).val();e.originalEvent&&!isNaN(a)&&n.setPosition(o,new google.maps.LatLng(a,o.location.lng()),(function(t){t.settings.onchanged.apply(o.domContainer,[n.locationFromLatLng(t.location),t.radius,!1]),i(o.settings.inputBinding,o)}))})),e.longitudeInput&&e.longitudeInput.on("change",(function(e){var a=t(this).val();e.originalEvent&&!isNaN(a)&&n.setPosition(o,new google.maps.LatLng(o.location.lat(),a),(function(t){t.settings.onchanged.apply(o.domContainer,[n.locationFromLatLng(t.location),t.radius,!1]),i(o.settings.inputBinding,o)}))}))}}t.fn.locationpicker=function(s,l){if("string"==typeof s){var u=this.get(0);if(!o(u))return;var c=a(u);switch(s){case"location":if(null==l){var d=n.locationFromLatLng(c.location);return d.radius=c.radius,d.name=c.locationName,d}l.radius&&(c.radius=l.radius),n.setPosition(c,new google.maps.LatLng(l.latitude,l.longitude),(function(t){i(t.settings.inputBinding,t)}));break;case"subscribe":if(null==l)return null;var g=l.event,m=l.callback;if(!g||!m)return console.error('LocationPicker: Invalid arguments for method "subscribe"'),null;google.maps.event.addListener(c.map,g,m);break;case"map":if(null==l){var p=n.locationFromLatLng(c.location);return p.formattedAddress=c.locationName,p.addressComponents=c.addressComponents,{map:c.map,marker:c.marker,location:p}}return null;case"autosize":return function(t){google.maps.event.trigger(t.map,"resize"),setTimeout((function(){t.map.setCenter(t.marker.position)}),300)}(c),this}return null}return this.each((function(){var l=t(this);if(o(this))!function(e,o,a){var i=t.extend({},t.fn.locationpicker.defaults,a),s=i.location.latitude,l=i.location.longitude,u=i.radius,c=e.settings.location.latitude,d=e.settings.location.longitude,g=e.settings.radius;s==c&&l==d&&u==g||(e.settings.location.latitude=s,e.settings.location.longitude=l,e.radius=u,n.setPosition(e,new google.maps.LatLng(e.settings.location.latitude,e.settings.location.longitude),(function(t){r(e.settings.inputBinding,e),t.settings.oninitialized(o)})))}(a(this),t(this),s);else{var u=t.extend({},t.fn.locationpicker.defaults,s),c=new e(this,t.extend({},{zoom:u.zoom,center:new google.maps.LatLng(u.location.latitude,u.location.longitude),mapTypeId:u.mapTypeId,mapTypeControl:!1,styles:u.styles,disableDoubleClickZoom:!1,scrollwheel:u.scrollwheel,streetViewControl:!1,radius:u.radius,locationName:u.locationName,settings:u,autocompleteOptions:u.autocompleteOptions,addressFormat:u.addressFormat,draggable:u.draggable,markerIcon:u.markerIcon,markerDraggable:u.markerDraggable,markerVisible:u.markerVisible},u.mapOptions));l.data("locationpicker",c),u.markerInCenter&&(c.map.addListener("bounds_changed",(function(){c.marker.dragging||(c.marker.setPosition(c.map.center),i(c.settings.inputBinding,c))})),c.map.addListener("idle",(function(){c.marker.dragging||d()}))),google.maps.event.addListener(c.marker,"drag",(function(t){i(c.settings.inputBinding,c)})),google.maps.event.addListener(c.marker,"dragend",(function(t){d()})),n.setPosition(c,new google.maps.LatLng(u.location.latitude,u.location.longitude),(function(t){i(u.inputBinding,c),r(u.inputBinding,c),t.settings.oninitialized(l)}))}function d(){n.setPosition(c,c.marker.position,(function(t){var e=n.locationFromLatLng(c.location);i(c.settings.inputBinding,c),t.settings.onchanged.apply(c.domContainer,[e,t.radius,!0])}))}}))},t.fn.locationpicker.defaults={location:{latitude:40.7324319,longitude:-73.82480777777776},locationName:"",radius:500,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[],mapOptions:{},scrollwheel:!0,inputBinding:{latitudeInput:null,longitudeInput:null,radiusInput:null,locationNameInput:null},enableAutocomplete:!1,enableAutocompleteBlur:!1,autocompleteOptions:null,addressFormat:"postal_code",enableReverseGeocode:!0,draggable:!0,onchanged:function(t,e,n){},onlocationnotfound:function(t){},oninitialized:function(t){},markerIcon:void 0,markerDraggable:!0,markerVisible:!0}}(jQuery);